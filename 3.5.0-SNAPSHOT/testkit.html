<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Slick TestKit · Slick</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='Scala Slick documentation'/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/warnOldVersion.js"></script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/snippets.js"></script>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="css/page.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="index.html" >
<span class="home-icon">⌂</span>Slick
</a>
<div class="version-number">
<ul class="menu version-menu" data-options="disableHover: true; clickOpen: true; closeOnClickInside: false;">
<li class="is-dropdown-submenu-parent">
<a href="#">
3.5.0-pre.88.a189ac54
</a>
<ul class="menu">
</ul>
</li>
</ul>
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="introduction.html" class="page">Introduction</a></li>
  <li><a href="supported-databases.html" class="page">Supported Databases</a></li>
  <li><a href="gettingstarted.html" class="page">Getting Started</a></li>
  <li><a href="concepts.html" class="page">Core Concepts</a></li>
  <li><a href="database.html" class="page">Database Configuration</a></li>
  <li><a href="dbio.html" class="page">Database I/O Actions</a></li>
  <li><a href="schemas.html" class="page">Schemas</a>
  <ul>
    <li><a href="datetimetypes.html" class="page">Date and Time types</a></li>
  </ul></li>
  <li><a href="queries.html" class="page">Queries</a></li>
  <li><a href="code-generation.html" class="page">Schema Code Generation</a></li>
  <li><a href="userdefined.html" class="page">User-Defined Features</a></li>
  <li><a href="sql.html" class="page">Plain SQL Queries</a></li>
  <li><a href="orm-to-slick.html" class="page">Coming from ORM to Slick</a></li>
  <li><a href="sql-to-slick.html" class="page">Coming from SQL to Slick</a></li>
  <li><a href="cookbook.html" class="page">Cookbook</a></li>
  <li><a href="upgrade.html" class="page">Upgrade Guides</a>
  <ul>
    <li><a href="compat-report.html" class="page">Incompatible changes</a></li>
  </ul></li>
  <li><a href="migrations.html" class="page">Database Migrations</a></li>
  <li><a href="testkit.html" class="active page">Slick TestKit</a></li>
  <li><a href="documentation.html" class="page">Markdown Documentation</a></li>
  <li><a href="config.html" class="page">Configuration</a></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title"><a href="index.html">Slick</a></div>

<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="index.html" >
<span class="home-icon">⌂</span>Slick
</a>
<div class="version-number">
<ul class="menu version-menu" data-options="disableHover: true; clickOpen: true; closeOnClickInside: false;">
<li class="is-dropdown-submenu-parent">
<a href="#">
3.5.0-pre.88.a189ac54
</a>
<ul class="menu">
</ul>
</li>
</ul>
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="introduction.html" class="page">Introduction</a></li>
  <li><a href="supported-databases.html" class="page">Supported Databases</a></li>
  <li><a href="gettingstarted.html" class="page">Getting Started</a></li>
  <li><a href="concepts.html" class="page">Core Concepts</a></li>
  <li><a href="database.html" class="page">Database Configuration</a></li>
  <li><a href="dbio.html" class="page">Database I/O Actions</a></li>
  <li><a href="schemas.html" class="page">Schemas</a>
  <ul>
    <li><a href="datetimetypes.html" class="page">Date and Time types</a></li>
  </ul></li>
  <li><a href="queries.html" class="page">Queries</a></li>
  <li><a href="code-generation.html" class="page">Schema Code Generation</a></li>
  <li><a href="userdefined.html" class="page">User-Defined Features</a></li>
  <li><a href="sql.html" class="page">Plain SQL Queries</a></li>
  <li><a href="orm-to-slick.html" class="page">Coming from ORM to Slick</a></li>
  <li><a href="sql-to-slick.html" class="page">Coming from SQL to Slick</a></li>
  <li><a href="cookbook.html" class="page">Cookbook</a></li>
  <li><a href="upgrade.html" class="page">Upgrade Guides</a>
  <ul>
    <li><a href="compat-report.html" class="page">Incompatible changes</a></li>
  </ul></li>
  <li><a href="migrations.html" class="page">Database Migrations</a></li>
  <li><a href="testkit.html" class="active page">Slick TestKit</a></li>
  <li><a href="documentation.html" class="page">Markdown Documentation</a></li>
  <li><a href="config.html" class="page">Configuration</a></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<span id="version-warning"></span>

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="index.html">Slick</a></li>
  <li>Slick TestKit</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#slick-testkit" name="slick-testkit" class="anchor"><span class="anchor-link"></span></a>Slick TestKit</h1>
<p>When you write your own database profile for Slick, you need a way to run all the standard unit tests on it (in addition to any custom tests you may want to add) to ensure that it works correctly and does not claim to support any capabilities which are not actually implemented. For this purpose the Slick unit tests have been factored out into a separate <em>Slick TestKit</em> project.</p>
<p>To get started, you can download <a href="https://github.com/slick/slick-testkit-example">the <strong>TestKit Example</strong> project</a> which contains a copy of Slick&rsquo;s standard PostgreSQL profile and all the infrastructure required to build and test it.</p>
<h2><a href="#scaffolding" name="scaffolding" class="anchor"><span class="anchor-link"></span></a>Scaffolding</h2>
<p>Its <code>build.sbt</code> file is straight-forward. It adds the dependencies for Slick, TestKit, junit-interface, Logback and the PostgreSQL JDBC driver, and it sets some options for the test runs:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/slick/slick/tree/main/doc/paradox/samples/slick-testkit-example/build.sbt" target="_blank" title="Go to snippet source">source</a><code class="language-sbt">import _root_.io.github.nafg.mergify.dsl._


mergifyExtraConditions := Seq(
  (Attr.Author :== &quot;scala-steward&quot;) ||
    (Attr.Author :== &quot;slick-scala-steward[bot]&quot;) ||
    (Attr.Author :== &quot;renovate[bot]&quot;)
)

libraryDependencies ++= List(
  &quot;com.github.sbt&quot; % &quot;junit-interface&quot; % &quot;0.13.3&quot; % Test,
  &quot;ch.qos.logback&quot; % &quot;logback-classic&quot; % &quot;1.4.11&quot; % Test,
  &quot;org.postgresql&quot; % &quot;postgresql&quot; % &quot;42.6.0&quot; % Test,
)

scalacOptions += &quot;-deprecation&quot;

Test / parallelExecution := false

logBuffered := false

run / fork := true

testOptions += Tests.Argument(TestFrameworks.JUnit, &quot;-q&quot;, &quot;-v&quot;, &quot;-s&quot;, &quot;-a&quot;)
libraryDependencies += &quot;com.typesafe.slick&quot; %% &quot;slick-testkit&quot; % &quot;3.4.1&quot;

ThisBuild / githubWorkflowBuildPreamble +=
  WorkflowStep.Run(List(&quot;docker-compose up -d&quot;), name = Some(&quot;Start database&quot;))</code></pre>
<p>There is a copy of Slick&rsquo;s logback configuration in <code>src/test/resources/logback-test.xml</code> but you can swap out the logging framework if you prefer a different one.</p>
<h2><a href="#profile" name="profile" class="anchor"><span class="anchor-link"></span></a>Profile</h2>
<p>The actual profile implementation can be found under <code>src/main/scala</code>:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/slick/slick/tree/main/doc/paradox/samples/slick-testkit-example/src/main/scala/MyPostgresProfile.scala#L2-L265" target="_blank" title="Go to snippet source">source</a><code class="language-scala">package com.example

trait MyPostgresProfile extends JdbcProfile {
  // ...
}

object MyPostgresProfile extends MyPostgresProfile</code></pre>
<h2><a href="#test-harness" name="test-harness" class="anchor"><span class="anchor-link"></span></a>Test Harness</h2>
<p>In order to run the TestKit tests, you need to add a class that extends <code>ProfileTest</code>, plus an implementation of <code>TestDB</code> which tells TestKit how to connect to a test database, get a list of tables, clean up between tests, etc.</p>
<p>In the case of the PostgreSQL test harness (in <code>src/test/scala/MyPostgresTest.scala</code>) most of the default implementations can be used out of the box. Only <code>localTables</code> and <code>getLocalSequences</code> require custom implementations. We also modify the profile&rsquo;s <code>capabilities</code> to indicate that our profile does not support the JDBC <code>getFunctions</code> call:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/slick/slick/tree/main/doc/paradox/samples/slick-testkit-example/src/test/scala/MyPostgresTest.scala#L11-L29" target="_blank" title="Go to snippet source">source</a><code class="language-scala">@RunWith(classOf[Testkit])
class MyPostgresTest extends ProfileTest(MyPostgresTest.tdb)

object MyPostgresTest {
  def tdb = new ExternalJdbcTestDB(&quot;mypostgres&quot;) {
    val profile = MyPostgresProfile
    override def localTables(implicit ec: ExecutionContext): DBIO[Vector[String]] =
      ResultSetAction[(String,String,String, String)](_.conn.getMetaData().getTables(&quot;&quot;, &quot;public&quot;, null, null)).map { ts =&gt;
        ts.filter(_._4.toUpperCase == &quot;TABLE&quot;).map(_._3).sorted
      }
    override def localSequences(implicit ec: ExecutionContext): DBIO[Vector[String]] =
      ResultSetAction[(String,String,String, String)](_.conn.getMetaData().getTables(&quot;&quot;, &quot;public&quot;, null, null)).map { ts =&gt;
        ts.filter(_._4.toUpperCase == &quot;SEQUENCE&quot;).map(_._3).sorted
      }
    override def capabilities = super.capabilities - TestDB.capabilities.jdbcMetaGetFunctions
  }
}</code></pre>
<p>The name of a configuration prefix, in this case <code>mypostgres</code>, is passed to <code>ExternalJdbcTestDB</code>:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/slick/slick/tree/main/doc/paradox/samples/slick-testkit-example/src/test/scala/MyPostgresTest.scala#L16" target="_blank" title="Go to snippet source">source</a><code class="language-scala">def tdb = new ExternalJdbcTestDB(&quot;mypostgres&quot;) {</code></pre>
<h2><a href="#database-configuration" name="database-configuration" class="anchor"><span class="anchor-link"></span></a>Database Configuration</h2>
<p>Since the PostgreSQL test harness is based on <code>ExternalJdbcTestDB</code>, it needs to be configured in <code>test-dbs/testkit.conf</code>:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/slick/slick/tree/main/doc/paradox/samples/slick-testkit-example/test-dbs/testkit.conf" target="_blank" title="Go to snippet source">source</a><code class="language-conf"># Enable the tests for mypostgres:
mypostgres.enabled = true

# Set the user name (default: &quot;postgres&quot;)
mypostgres.user = &quot;postgres&quot;

# Set the password (default: no password)
mypostgres.password = postgres

mypostgres.create = CREATE DATABASE ${testDB} &quot;TEMPLATE = template0&quot;

mypostgres.baseURL = &quot;jdbc:postgresql://localhost:54325/&quot;</code></pre>
<p>There are several other configuration options that need to be set for an <code>ExternalJdbcTestDB</code>. These are defined with suitable defaults in <code>testkit-reference.conf</code> so that <code>testkit.conf</code> can be kept very simple in most cases:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/slick/slick/tree/main/doc/paradox/samples/slick-testkit-example/src/test/resources/testkit-reference.conf" target="_blank" title="Go to snippet source">source</a><code class="language-conf">mypostgres {
  baseURL = &quot;jdbc:postgresql:&quot;
  user = postgres
  adminDB = postgres
  create = [
    CREATE TABLESPACE slick_test LOCATION &#39;${testkit.absTestDir}&#39;
    CREATE DATABASE ${testDB} &quot;TEMPLATE = template0 TABLESPACE slick_test&quot;
  ]
  postCreate = &quot;create extension lo&quot;
  drop = [
    DROP DATABASE IF EXISTS ${testDB}
    DROP TABLESPACE IF EXISTS slick_test
  ]
  driver = org.postgresql.Driver
}</code></pre>
<h2><a href="#testing" name="testing" class="anchor"><span class="anchor-link"></span></a>Testing</h2>
<p>Running <code>sbt test</code> discovers <code>MyPostgresTest</code> and runs it with TestKit&rsquo;s JUnit runner. This in turn causes the database to be set up through the test harness and all tests which are applicable for the profile (as determined by the <code>capabilities</code> setting in the test harness) to be run.</p>
<div class="source-github">
The source code for this page can be found <a href="https://github.com/slick/slick/tree/main/doc/paradox/testkit.md">here</a>.
</div>

<div class="nav-next">
<p><strong>Next:</strong> <a href="documentation.html">Markdown Documentation</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="testkit.html#slick-testkit" class="header">Slick TestKit</a>
  <ul>
    <li><a href="testkit.html#scaffolding" class="header">Scaffolding</a></li>
    <li><a href="testkit.html#profile" class="header">Profile</a></li>
    <li><a href="testkit.html#test-harness" class="header">Test Harness</a></li>
    <li><a href="testkit.html#database-configuration" class="header">Database Configuration</a></li>
    <li><a href="testkit.html#testing" class="header">Testing</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2023</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/magellan.js"></script>
<script type="text/javascript" src="js/versions.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>
<script type="text/javascript">jQuery(function(jq){initOldVersionWarnings(jq, '3.5.0-pre.88.a189ac54', '')});</script>


</html>
