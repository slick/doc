
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Slick TestKit &mdash; Slick 3.2.0-M1 documentation</title>
    
    <link rel="stylesheet" href="_static/slick.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.2.0-M1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Slick 3.2.0-M1 documentation" href="index.html" />
    <link rel="next" title="Sphinx Documentation" href="sphinx-documentation.html" />
    <link rel="prev" title="Database Migrations" href="migrations.html" />
<script type="text/javascript">
if(window.location.host == 'slick.typesafe.com'){
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23127719-3']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();  
}
</script>

  </head>
  <body role="document">
    <div class="header-wrapper">
      <div class="header">
        <div class="rel">
        <span class="github"><a href="https://github.com/slick/slick/edit/master/slick/src/sphinx/testkit.rst">edit this page on github</a><span>
          |
          <a href="migrations.html" title="Database Migrations"
             accesskey="P">previous</a> |
          <a href="sphinx-documentation.html" title="Sphinx Documentation"
             accesskey="N">next</a> |
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
        <div class="headertitle"><a href="index.html">
            <span class="logo"><img class="logo" src="_static/slick-logo.png" alt="Slick"/></span>
          3.2.0-M1 manual
        </a></div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <span class="target" id="index-0"></span><div class="section" id="slick-testkit">
<span id="index-1"></span><h1>Slick TestKit<a class="headerlink" href="#slick-testkit" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This chapter is based on the <a class="reference external" href="https://typesafe.com/activator/template/slick-testkit-example-3.2">Slick TestKit Example template</a>.
The preferred way of reading this introduction is in <a class="reference external" href="https://typesafe.com/activator">Activator</a>, where you can
edit and run the code directly while reading the tutorial.</p>
</div>
<p>When you write your own database profile for Slick, you need a way to run all
the standard unit tests on it (in addition to any custom tests you may want to
add) to ensure that it works correctly and does not claim to support any
capabilities which are not actually implemented. For this purpose the Slick
unit tests have been factored out into a separate Slick TestKit project.</p>
<p>To get started, you can clone the <a class="reference external" href="https://typesafe.com/activator/template/slick-testkit-example-3.2">Slick TestKit Example template</a> which
contains a copy of Slick&#8217;s standard PostgreSQL profile and all the infrastructure
required to build and test it.</p>
<div class="section" id="scaffolding">
<h2>Scaffolding<a class="headerlink" href="#scaffolding" title="Permalink to this headline">¶</a></h2>
<p>Its <code class="docutils literal"><span class="pre">build.sbt</span></code> file is straight-forward. Apart from the usual name and
version settings, it adds the dependencies for Slick, the TestKit,
junit-interface, Logback and the PostgreSQL JDBC driver, and it sets some
options for the test runs:</p>
<pre class="literal-block">
libraryDependencies ++= Seq(
  &quot;com.typesafe.slick&quot; %% &quot;slick&quot; % &quot;3.2.0-M1&quot;,
  &quot;com.typesafe.slick&quot; %% &quot;slick-testkit&quot; % &quot;3.2.0-M1&quot; % &quot;test&quot;,
  &quot;com.novocode&quot; % &quot;junit-interface&quot; % &quot;0.10&quot; % &quot;test&quot;,
  &quot;ch.qos.logback&quot; % &quot;logback-classic&quot; % &quot;0.9.28&quot; % &quot;test&quot;,
  &quot;postgresql&quot; % &quot;postgresql&quot; % &quot;9.1-901.jdbc4&quot; % &quot;test&quot;
)

testOptions += Tests.Argument(TestFrameworks.JUnit, &quot;-q&quot;, &quot;-v&quot;, &quot;-s&quot;, &quot;-a&quot;)

parallelExecution in Test := false

logBuffered := false
</pre>
<p>There is a copy of Slick&#8217;s logback configuration in
<code class="docutils literal"><span class="pre">src/test/resources/logback-test.xml</span></code> but you can swap out the logging
framework if you prefer a different one.</p>
</div>
<div class="section" id="profile">
<h2>Profile<a class="headerlink" href="#profile" title="Permalink to this headline">¶</a></h2>
<p>The actual profile implementation can be found under <code class="docutils literal"><span class="pre">src/main/scala</span></code>.</p>
</div>
<div class="section" id="test-harness">
<span id="index-2"></span><h2>Test Harness<a class="headerlink" href="#test-harness" title="Permalink to this headline">¶</a></h2>
<p>In order to run the TestKit tests, you need to add a class that extends
<code class="docutils literal"><span class="pre">ProfileTest</span></code>, plus an implementation of <code class="docutils literal"><span class="pre">TestDB</span></code> which tells the TestKit
how to connect to a test database, get a list of tables, clean up between
tests, etc.</p>
<p>In the case of the PostgreSQL test harness (in <code class="docutils literal"><span class="pre">src/test/slick/jdbc/test/MyPostgresTest.scala</span></code>)
most of the default implementations can be used out of the box. Only <code class="docutils literal"><span class="pre">localTables</span></code> and
<code class="docutils literal"><span class="pre">getLocalSequences</span></code> require custom implementations. We also modify the profile&#8217;s <code class="docutils literal"><span class="pre">capabilities</span></code>
to indicate that our profile does not support the JDBC <code class="docutils literal"><span class="pre">getFunctions</span></code> call:</p>
<div class="highlight-scala"><div class="highlight"><pre><span></span><span class="nd">@RunWith</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">Testkit</span><span class="o">])</span>
<span class="k">class</span> <span class="nc">MyPostgresTest</span> <span class="k">extends</span> <span class="nc">ProfileTest</span><span class="o">(</span><span class="nc">MyPostgresTest</span><span class="o">.</span><span class="n">tdb</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">MyPostgresTest</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">tdb</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ExternalJdbcTestDB</span><span class="o">(</span><span class="s">&quot;mypostgres&quot;</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">profile</span> <span class="k">=</span> <span class="nc">MyPostgresProfile</span>
    <span class="k">override</span> <span class="k">def</span> <span class="n">localTables</span><span class="o">(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span> <span class="kt">ExecutionContext</span><span class="o">)</span><span class="k">:</span> <span class="kt">DBIO</span><span class="o">[</span><span class="kt">Vector</span><span class="o">[</span><span class="kt">String</span><span class="o">]]</span> <span class="k">=</span>
      <span class="nc">ResultSetAction</span><span class="o">[(</span><span class="kt">String</span>,<span class="kt">String</span>,<span class="kt">String</span>, <span class="kt">String</span><span class="o">)](</span><span class="k">_</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">getMetaData</span><span class="o">().</span><span class="n">getTables</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="s">&quot;public&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">)).</span><span class="n">map</span> <span class="o">{</span> <span class="n">ts</span> <span class="k">=&gt;</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">_4</span><span class="o">.</span><span class="n">toUpperCase</span> <span class="o">==</span> <span class="s">&quot;TABLE&quot;</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">_3</span><span class="o">).</span><span class="n">sorted</span>
      <span class="o">}</span>
    <span class="k">override</span> <span class="k">def</span> <span class="n">getLocalSequences</span><span class="o">(</span><span class="k">implicit</span> <span class="n">session</span><span class="k">:</span> <span class="kt">profile.Backend</span><span class="k">#</span><span class="kt">Session</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
      <span class="k">val</span> <span class="n">tables</span> <span class="k">=</span> <span class="nc">ResultSetInvoker</span><span class="o">[(</span><span class="kt">String</span>,<span class="kt">String</span>,<span class="kt">String</span>, <span class="kt">String</span><span class="o">)](</span><span class="k">_</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">getMetaData</span><span class="o">().</span><span class="n">getTables</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="s">&quot;public&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">))</span>
      <span class="n">tables</span><span class="o">.</span><span class="n">buildColl</span><span class="o">[</span><span class="kt">List</span><span class="o">].</span><span class="n">filter</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">_4</span><span class="o">.</span><span class="n">toUpperCase</span> <span class="o">==</span> <span class="s">&quot;SEQUENCE&quot;</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">_3</span><span class="o">).</span><span class="n">sorted</span>
    <span class="o">}</span>
    <span class="k">override</span> <span class="k">def</span> <span class="n">capabilities</span> <span class="k">=</span> <span class="k">super</span><span class="o">.</span><span class="n">capabilities</span> <span class="o">-</span> <span class="nc">TestDB</span><span class="o">.</span><span class="n">capabilities</span><span class="o">.</span><span class="n">jdbcMetaGetFunctions</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p id="index-3">The name of a configuration prefix, in this case <code class="docutils literal"><span class="pre">mypostgres</span></code>, is passed to <code class="docutils literal"><span class="pre">ExternalJdbcTestDB</span></code>:</p>
<div class="highlight-scala"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">tdb</span> <span class="k">=</span>
  <span class="k">new</span> <span class="nc">ExternalJdbcTestDB</span><span class="o">(</span><span class="s">&quot;mypostgres&quot;</span><span class="o">)</span> <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="database-configuration">
<h2>Database Configuration<a class="headerlink" href="#database-configuration" title="Permalink to this headline">¶</a></h2>
<p>Since the PostgreSQL test harness is based on <code class="docutils literal"><span class="pre">ExternalJdbcTestDB</span></code>, it needs to be configured in
<code class="docutils literal"><span class="pre">test-dbs/testkit.conf</span></code>:</p>
<div class="highlight-scala"><div class="highlight"><pre><span></span><span class="n">mypostgres</span><span class="o">.</span><span class="n">enabled</span> <span class="k">=</span> <span class="kc">true</span>
<span class="n">mypostgres</span><span class="o">.</span><span class="n">user</span> <span class="k">=</span> <span class="n">myuser</span>
<span class="n">mypostgres</span><span class="o">.</span><span class="n">password</span> <span class="k">=</span> <span class="n">secret</span>
</pre></div>
</div>
<p>There are several other configuration options that need to be set for an <code class="docutils literal"><span class="pre">ExternalJdbcTestDB</span></code>.
These are defined with suitable defaults in <code class="docutils literal"><span class="pre">testkit-reference.conf</span></code> so that <code class="docutils literal"><span class="pre">testkit.conf</span></code> can
be kept very simple in most cases.</p>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p>Running <code class="docutils literal"><span class="pre">sbt</span> <span class="pre">test</span></code> discovers <code class="docutils literal"><span class="pre">MyPostgresTest</span></code> and runs it with TestKit&#8217;s
JUnit runner. This in turn causes the database to be set up through the test
harness and all tests which are applicable for the profile (as determined by
the <code class="docutils literal"><span class="pre">capabilities</span></code> setting in the test harness) to be run.</p>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Search</h3>
          <form class="search" action="search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
            <h3 style="margin-top: 1.5em;">Table Of Contents</h3>
            <ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="supported-databases.html">Supported Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Core Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Database Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="dbio.html">Database I/O Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="schemas.html">Schemas</a></li>
<li class="toctree-l1"><a class="reference internal" href="queries.html">Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-generation.html">Schema Code Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="userdefined.html">User-Defined Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="sql.html">Plain SQL Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="orm-to-slick.html">Coming from ORM to Slick</a></li>
<li class="toctree-l1"><a class="reference internal" href="sql-to-slick.html">Coming from SQL to Slick</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrade.html">Upgrade Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="migrations.html">Database Migrations</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Slick TestKit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#scaffolding">Scaffolding</a></li>
<li class="toctree-l2"><a class="reference internal" href="#profile">Profile</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-harness">Test Harness</a></li>
<li class="toctree-l2"><a class="reference internal" href="#database-configuration">Database Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sphinx-documentation.html">Sphinx Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html#logging">Logging</a></li>
</ul>

        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="migrations.html" title="Database Migrations"
             >previous</a> |
          <a href="sphinx-documentation.html" title="Sphinx Documentation"
             >next</a> |
          <a href="genindex.html" title="General Index"
             >index</a>

        </div>
        <div class="right">
          
    <div class="footer" role="contentinfo">
        &copy; Copyright 2011-2016 Typesafe, Inc.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.4.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>